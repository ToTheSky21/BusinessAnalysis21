---
title: Final Project
author: R package build
date: '2021-06-21'
slug: final-project
categories:
  - tidymodels
  - Tidyverse
  - ggplot2
tags: []
---
## Data Analysis to fit Linear Regression Model:
This is an exploratory data analysis report to fit the simple Linear Regression Model. This report concerns a dataset about Life Expectancy.
```{r echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(tidymodels)
library(ggtext)
library(knitr)
library(kableExtra)
set.seed(1234)
options(dplyr.print_min = 10, dplyr.print_max = 6)
```
## Categorical and numerical explanatory variables analysis:

For finding whether there is any relation between the dataset or not, I have done some basic analysis to find the dependent and independent variables.From these analysis, the variable Life Expectancy has came out as dependent variable(y) as it is effected by other predictive variables.  

## Data: Life Expectancy

This Dataset is about Life Expectancy of different countries with several related variables(See below on printed Head of dataset). The data was collected from WHO and United Nations website aiming that this will help in suggesting a country which area should be given importance in order to efficiently improve the life expectancy of its population.Since the observations this dataset are based on different countries, it will be easier for a country to determine the predicting factor which is contributing to lower value of life expectancy.

I have collected this dataset from the following website: https://www.kaggle.com/kumarajarshi/life-expectancy-who
```{r echo=FALSE, warning=FALSE, message=FALSE}
le <- read_csv("Life Expectancy Data.csv", na = c("n/a", "", "NA"))
head(le)
```
## Exploring Dataset: 

Now, I will conduct some primary data visualization to explore the dataset with scatter plot and bar diagram which are shown below.

## GDP by POPULATION

The following basic scatter plot is done to understand the relation between Population and GDP. It shows countries with highest GDP has lower population.
```{r echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(hrbrthemes)
df1 <- data.frame(le$Population, le$GDP)
#na.omit(df1)
ggplot(df1, mapping=aes(x=le$Population, y=le$GDP, alpha=0.6)) +
  geom_point(size=4, color="#69b3a2") +
  labs(tittle = "GDP vs POPULATION",
     x = "POPULATION",
     y = "GDP") +
    theme_ipsum()
```
## Life Expectancy by Year:

To know whether the Life Expectancy is changing by Year or not I have chosen one Country(Canada). Here, it shows
that in the Year 2006 to 2008 it has changed and then resulted the same ages of life expectancy. 
```{r echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(tidyverse)
library(dplyr)
library(plyr)
df2 <- le %>%
filter(Country == "Canada")
ggplot(df2, mapping=aes(x=df2$Year, y=df2$`Life expectancy`)) +
    geom_bar(stat="identity", fill="#f68060", alpha=.6, width=.4) +
    labs(tittle = "Year vs Life Expectancy",
     x = "Year",
     y = "Life expectancy")
```
## Hepatitis B by Alcohol:

This plot shows how these Alcohol and Hepatitis B are related.This plot shows the percent of immunization for Hepatitis B are not positively related to Alcohol consumption,where Alcohol is recorded per capita (15+) consumption (in litres of pure alcohol) and Hepatitis B (HepB) as immunization coverage among 1-year-olds (%).
```{r echo=FALSE, warning=FALSE, message=FALSE}
library(stats)
dfsc <- data.frame(le$Alcohol, le$`Hepatitis B`)
scatter.smooth(x=le$Alcohol, y=le$`Hepatitis B`, main="Alcohol vs Hepatitis B")

```
## Adult Mortality by Alcohol:
Here the variable Adult Mortality Rates are calculated for both sexes (probability of dying between 15 and 60 years per 1000 population). The more Alcohol consumption is not indicating higher Adult Mortality rate.
```{r echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(hrbrthemes)
df3 <- data.frame(le$Alcohol, le$`Adult Mortality`)
#na.omit(df3)
ggplot(df3, mapping=aes(x=le$Alcohol, y=le$`Adult Mortality`, alpha=0.5)) +
  geom_point(size=4, color="#69b3a2") +
  labs(tittle = "Alcohol vs Adult Mortality",
     x = "Alcohol",
     y = "Adult Mortality") +
    theme_ipsum()
```
## Adding Linear Regression lines to the plotted variables 
Before fitting the Linear Regression model with one independent variable,I have visualized the relationship between some independent variables with the dependent variable,Life expectancy. 

##Life expectancy by GDP:
```{r  echo=FALSE, warning=FALSE, message=FALSE}
ggplot(data = le, aes(x = le$GDP, y = le$`Life expectancy`)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "#8E2C90") +
  labs(
    title = "GDP vs. Life expectancy",
    x = "GDP",
    y = "Life Expectancy"
  )
```
## Life expectancy by Adult Mortality:
```{r  echo=FALSE, warning=FALSE, message=FALSE}
ggplot(data = le, aes(y = le$`Life expectancy`, x = le$`Adult Mortality`)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "#8E2C90") +
  labs(
    title = "Adult Mortality vs. Life expectancy",
    x = "Adult Mortality",
    y = "Life expectancy"
  )
```
## Life expectancy by Percentage Expenditure: 
```{r  echo=FALSE, warning=FALSE, message=FALSE}
ggplot(data = le, aes(y = le$`Life expectancy`, x = le$`percentage expenditure`)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "#8E2C90") +
  labs(
    title = "Percentage Expenditure vs. Life expectancy",
    x = "Percentage Expenditure",
    y = "Life Expectancy"
  )
```
## Life Expectancy by Income composition of resources:
```{r  echo=FALSE, warning=FALSE, message=FALSE}
ggplot(data = le, aes(y = le$`Life expectancy`, x = le$`Income composition of resources`)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "#8E2C90") +
  labs(
    title = "Income composition of resources vs. Life Expectancy",
    x = "Income composition of resources",
    y = "Life Expectancy"
  )
```
## Life Expectancy by Schooling:
```{r  echo=FALSE, warning=FALSE, message=FALSE}
ggplot(data = le, aes(y = le$`Life expectancy`, x = le$Schooling)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "#8E2C90") +
  labs(
    title = "Schooling vs. Life Expectancy",
    x = "Schooling(in year)",
    y = "Life Expectancy(in age)"
  )
```
## Fitting and Interpretting Linear Regression Model:

In this data set there are several independent variables, but for fitting Linear Regression model I have chosen one predictor, namely Schooling for further steps.Now, the goal is to predict Life Expectancy(in age) from Schooling, number of years of Schooling(years).

The function is: Life Expectancy = β0 + β1 * Schooling where, “β0” and "β1” are the intercept and the slope respectively.

## Step 1: Specify model
```{r echo=FALSE, warning=FALSE, message=FALSE}
linear_reg()
```
## Step 2: Set model fitting *engine*
```{r}
linear_reg() %>%
  set_engine("lm") # lm: linear model
```
## Step 3: Fit model & estimate parameters
```{r echo=FALSE, warning=FALSE, message=FALSE}
linear_reg() %>%
  set_engine("lm") %>%
  fit(le$`Life expectancy` ~ Schooling, data = le) 
```
## Closer look of the above output
```{r ref.label="fit-model", echo=FALSE}
```
.large[
$$\widehat{le$`Life expectancy`} = 44.109 + 2.103 \times Schooling$$
]
## Step 4: Tidy look of model & parameters 
```{r fit-model}
linear_reg() %>%
  set_engine("lm") %>%
  fit(le$`Life expectancy` ~ Schooling, data = le) %>%
  tidy()
```
.large[
$$\widehat{Life} {expectancy} = 44.11 + 2.103 \times {Schooling}$$
]

## Interpretation of model coefficients:

The values of the intercept (“β0” value) and the slope (“β1” value) for the Schooling. These “β0” and "β1" values plot a line between all the points of the data. So in this case, if there is a person who goes to school for 12 years,when β0 is 44.11 and β1 is 2.103, the model predicts (on average) that Life Expectancy in age is around 44.11 + (2.103 * 12) = 69.346 age.

In another words,Slope means for each additional year a person's  Life expectancy is increased, the Schooling year is also expected to be longer, on average, by 2.10 years.

And the intercept means a person who have 0 years school are expected to be 44.11 ages of Life Expectancy , on average. 

## Linear model with a single predictor

- We're interested in $\beta_0$ (population parameter for the intercept) and $\beta_1$ (population parameter for the slope) in the following model: $$\hat{y}_{i} = \beta_0 + \beta_1~x_{i}$$

 we use sample statistics to estimate them:

$$\hat{y}_{i} = b_0 + b_1~x_{i}$$

## Least squares regression

As we know, the regression line minimizes the sum of squared residuals.Now I will show in the following steps how to do that.If $e_i = y_i - \hat{y}_i$, then, the regression line minimizes the $\sum_{i = 1}^n e_i^2$.

## Visualizing residuals

```{r vis-res-1, echo=FALSE, out.width="70%"}
ht_wt_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Height_in ~ Width_in, data = pp)
ht_wt_fit_tidy <- tidy(ht_wt_fit$fit) 
ht_wt_fit_aug  <- augment(ht_wt_fit$fit) %>%
  mutate(res_cat = ifelse(.resid > 0, TRUE, FALSE))
p <- ggplot(data = ht_wt_fit_aug, 
            aes(x = Width_in, y = Height_in)) +
  geom_point(alpha = 0.2) + 
  labs(
    title = "Height vs. width of paintings",
    subtitle = "Just the data",
    x = "Width (inches)",
    y = "Height (inches)"
    ) +
  coord_cartesian(xlim = c(0, 250), ylim = c(0, 200)) +
  theme(plot.subtitle = element_text(colour = "#E48957", face = "bold", size = rel(1.5)))
p
```

---

## Visualizing residuals (cont.)

```{r vis-res-2, echo=FALSE, out.width="70%"}
p <- p + 
  geom_smooth(method = "lm", color = "#8E2C90", se = FALSE) +
  geom_point(mapping = aes(y = .fitted), color = "#E48957") +
  labs(subtitle = "Data + least squares line")
p
```

---

## Visualizing residuals (cont.)

```{r vis-res-3, echo = FALSE, out.width="70%"}
p + 
  geom_segment(mapping = aes(xend = Width_in, yend = .fitted), color = "#E48957", alpha = 0.4) +
  labs(subtitle = "Data + least squares line + residuals")
```

---

## Properties of least squares regression

- The regression line goes through the center of mass point, the coordinates corresponding to average $x$ and average $y$, $(\bar{x}, \bar{y})$:  

$$\bar{y} = b_0 + b_1 \bar{x} ~ \rightarrow ~ b_0 = \bar{y} - b_1 \bar{x}$$

--
- The slope has the same sign as the correlation coefficient: $b_1 = r \frac{s_y}{s_x}$

--
- The sum of the residuals is zero: $\sum_{i = 1}^n e_i = 0$

--
- The residuals and $x$ values are uncorrelated

---

class: middle

# Models with categorical explanatory variables

---

## Categorical predictor with 2 levels

.pull-left-narrow[
.small[
```{r echo=FALSE}
pp %>% 
  select(name, Height_in, landsALL) %>%
  print(n = 20)
```
]
]
.pull-right-wide[
- `landsALL = 0`: No landscape features
- `landsALL = 1`: Some landscape features
]

---

## Height & landscape features

```{r ht-lands-fit}
linear_reg() %>%
  set_engine("lm") %>%
  fit(Height_in ~ factor(landsALL), data = pp) %>%
  tidy()
```

---

## Height & landscape features

$$\widehat{Height_{in}} = 22.7 - 5.645~landsALL$$

- **Slope:** Paintings with landscape features are expected, on average, to be 5.645 inches shorter than paintings that without landscape features
  - Compares baseline level (`landsALL = 0`) to the other level (`landsALL = 1`)
    
- **Intercept:** Paintings that don't have landscape features are expected, on average, to be 22.7 inches tall

---

## Relationship between height and school

```{r ht-school}
linear_reg() %>%
  set_engine("lm") %>%
  fit(Height_in ~ school_pntg, data = pp) %>%
  tidy()
```

---

## Dummy variables

```{r ref.label="ht-school", echo = FALSE}
```

- When the categorical explanatory variable has many levels, they're encoded to **dummy variables**
- Each coefficient describes the expected difference between heights in that particular school compared to the baseline level

---

## Categorical predictor with 3+ levels

.pull-left-wide[
```{r echo=FALSE}
dummy_df <- pp %>% 
  select(school_pntg) %>% 
  group_by(school_pntg) %>% 
  sample_n(1) %>%
  mutate(
    D_FL = as.integer(ifelse(school_pntg == "D/FL", 1L, 0)),
    F    = as.integer(ifelse(school_pntg == "F", 1L, 0)),
    G    = as.integer(ifelse(school_pntg == "G", 1L, 0)),
    I    = as.integer(ifelse(school_pntg == "I", 1L, 0)),
    S    = as.integer(ifelse(school_pntg == "S", 1L, 0)),
    X    = as.integer(ifelse(school_pntg == "X", 1L, 0))
  )
dummy_df %>%
  kable(align = "lcccccc") %>%
  kable_styling() %>%
  column_spec(2, width = "10em", background = spec_color(dummy_df$D_FL[1:7], end = 0.8), color = "white") %>%
  column_spec(3, width = "10em", background = spec_color(dummy_df$F[1:7], end = 0.8), color = "white") %>%
  column_spec(4, width = "10em", background = spec_color(dummy_df$G[1:7], end = 0.8), color = "white") %>%
  column_spec(5, width = "10em", background = spec_color(dummy_df$I[1:7], end = 0.8), color = "white") %>%
  column_spec(6, width = "10em", background = spec_color(dummy_df$S[1:7], end = 0.8), color = "white") %>%
  column_spec(7, width = "10em", background = spec_color(dummy_df$X[1:7], end = 0.8), color = "white")
```
]
.pull-right-narrow[
.small[
```{r echo=FALSE}
pp %>% 
  select(name, Height_in, school_pntg) %>%
  print(n = 20)
```
]
]

---

## Relationship between height and school

.small[
```{r ref.label="ht-school", echo=FALSE}
```

- **Austrian school (A)** paintings are expected, on average, to be **14 inches** tall.
- **Dutch/Flemish school (D/FL)** paintings are expected, on average, to be **2.33 inches taller** than *Austrian school* paintings.
- **French school (F)** paintings are expected, on average, to be **10.2 inches taller** than *Austrian school* paintings.
- **German school (G)** paintings are expected, on average, to be **1.65 inches taller** than *Austrian school* paintings.
- **Italian school (I)** paintings are expected, on average, to be **10.3 inches taller** than *Austrian school* paintings.
- **Spanish school (S)** paintings are expected, on average, to be **30.4 inches taller** than *Austrian school* paintings.
- Paintings whose school is **unknown (X)** are expected, on average, to be **2.87 inches taller** than *Austrian school* paintings.
]




